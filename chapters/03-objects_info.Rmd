---
output: html_document
editor_options: 
  chunk_output_type: console
---
# Получение информации об объекте {#objectinfo}
НАДО ПЕРЕПИСАТЬ! - классы могут быть как S3/S4/etc, плюс есть oldClass. Типы - базовые типы, которые имеют аналог в C типах

## Классы и типы объектов
Все объекты в R обладают радом базовых характеристик - класс объекта, который видит и использует пользователь, внутренний класс объекта, который используется в ядре R и тип хранения объектов в памяти. Подробнее об классах и типах см. #types_classes. Для определения этих характеристик используются следующие функции: 

- `class()` - определение класса объекта:
```{r 03-objects-info-1 }
# создаем вектор и смотрим его класс
x <- c('a', 'c', 'e')
class(x)

# создаем таблицу и смотрим ее класс
z <- data.frame(var1 = letters[1:5])
class(z)
```

- `typeof()` определяет внутренние для R типы объектов. Например, таблица имеет класс `data.frame`, но в ядре R имеет тип `list` и обрабатывается идентично:
```{r 03-objects-info-2 }
typeof(z)
```

- `mode()` или `storage.mode()` возвращают один из вариантов, с каким типом хранится объект в памяти. Обычно результаты  совпадает с `typeof`, но не всегда. Так как, как говорилось выше, массивы - это те же векторы, просто с атрибутом размерности, то и в памяти они хранятся с тем же типом, что и векторы:
```{r 03-objects-info-3 }
mx <- matrix('a', nrow = 2, ncol = 2)
print(mx)
class(mx)
typeof(mx)
mode(mx)
```

- `is.numeric()`, `is.character()`, `is.logical()` и прочие функции вида `is.*` - проверка, является ли объект объектом определенного класса или нет:
```{r 03-objects-info-4 }
is.character('Jane Dow')
is.logical(T)
```



## Измерения и длины объектов
Для большинства часто используемых объектов в R актуально понятие длины или измерения. Под длиной объекта можно понимать количество элементов в объекте - значений в векторе, элементов списка, колонок или строк в таблице и так далее. Основные функции для оценки длин объектов:

- `length()` для оценки количества элементов объекта. Например, количество элементов в векторе или количество элементов в списке. так как data.frame-таблицы также являются списками, то для таблиц `length()` отдает количество колонок:
```{r 03-objects-info-5 }
# создаем список, в первом элементе которого вектор латинских букв, во втором - названия месяцев
x <- list(lt = letters,
          mnth = month.name)

# определяем длину первого элемента вектора
length(x$lt)

# определяем количество элементов в векторе
length(x)

# определяем количество колонок в таблице iris
length(iris)
```

- `lengths()` - для оценки длин всех элементов списка одновременно:
```{r 03-objects-info-6 }
lengths(x)
```

- `nrow()` используется для оценки количества строк в таблице:
```{r 03-objects-info-7 }
nrow(iris)
```

- `ncol()` используется, аналогично `length()`, для оценки количества колонок в таблице
```{r 03-objects-info-8 }
ncol(iris)
```

Понятие измерений чаще используется для массивов, однако может быть применено и к таблицам, результатом будет количество колонок и строк таблицы:
```{r 03-objects-info-9 }
# создаем массив 2*3*2 и смотрим мерность:
new_mx <- array(0, dim = c(1, 3, 2))
print(new_mx)
dim(new_mx)
```


## Имена элементов и измерений объектов
Для получения и изменения названий элементов объектов - колонок в таблицах, элементов в именованных списках и векторах, используют функцию `names()`. Для массивов используется `dimnames()`:
```{r 03-objects-info-10 }
# создаем таблицу с колонками col1 и col2, получаем их названия
new_df <- data.frame(col1 = month.name[1:3], col2 = month.abb[1:3])
print(new_df)
names(new_df)

# создаем матрицу 2*2
new_mx <- matrix(1:4, nrow = 2, ncol = 2, dimnames = list(c('dim11', 'dim12'), c('dim21', 'dim22')))
print(new_mx)
dimnames(new_mx)
```
При работе с таблицами можно также использовать функции `colnames()` и `rownames()`, для получения и изменения названий колонок и строк соответственно. Стоит учесть, что если строкам таблицы не были присвоены названия, то названия все равно будут, в виде вектора значений `1:nrow(dataframe)`, сконвертированных в текст:
```{r 03-objects-info-11 }
print(new_df)
colnames(new_df)
rownames(new_df)
```

Имена могут быть неуникальными, однако это затрудняет некоторые операции (выделение подвыборки, объединение строк или столбцов), так что подобных ситуаций следует избегать. В редких случаях у элементов объектов может не быть имен, например, `names(5)` возвращает NULL.

Изменение имен идет несколько нехарактерным для большинства объектов R способом - новые значения присваиваются не какому-то объекту, а выражению вида `names(x)`. Это возможно, так как для подобных функций определен отдельный метод `names<-`, который обновляет вызываемый объект:

```{r 03-objects-info-12 }
# меняем названия колонок на col1, col2 и выводим таблицу:
rownames(new_df) <- c('raw1', 'raw2', 'raw3')
print(new_df)
```



## Атрибуты объектов
Практически все объекты в R имеют метаданные, которые называются атрибутами объекта и организованы в виде именованного спсика. Как правило, в атрибутах хранится класс объекта, названия строк и/или столбцов, мерность объекта и прочая полезная информация. Список атрибутов и их значений можно получить c помощью функции `attributes()`, либо вызвать значения конкретного атрибута с помощью функции `attr()`:
```{r 03-objects-info-13 }
# запрашиваем список атрибутов
attributes(mtcars)

# запрашиваем, какие имена колонок объекта
attr(mtcars, 'names')
```

Если у объекта нет атрибутов, то будет возвращен `NULL` (как правило, большинство функций R при создании объекта все же создают и его атрибуты):
```{r 03-objects-info-14 }
# создаем объект и не создаем для него атрибуты
x <- 5
attributes(x)

# используем базовую функцию для создания таблицы
x <- data.frame(v1 = 1:5)
attributes(x)
```

При необходимости атрибуты объектов можно создавать самостоятельно. Так как это, фактически, список дополнительных данных к объекту, то в атрибуты можно записать что угодно. В особо экстремальных случаях в атрибуты можно записать самостоятельные иные объекты, а не просто метаданные основного объекта. При этом значение объекта останется таким же, но в атрибутах будет много других данных:
```{r 03-objects-info-15 }
# создаем простой объект
x <- 'new object'

# создаем атрибут "description", в который записываем описание объекта
attr(x, 'description') <- 'simple text string'

# создаем дополнительный атрибут, в который записываем отдельную таблицу
attr(x, 'additional_table') <- data.frame(var1 = 1:5, var2 = letters[1:5])

# смотрим атрибуты объекта
attributes(x)
```

Аналогичным образом можно извлечь объекты, которые хранятся в атрибутах другого объекта:
```{r 03-objects-info-16}
add_label_df <- attr(x, 'additional_table')
str(add_label_df)
```



## Структура объектов
Нередко при работе с разными объектами необходимо получить сводную информацию об объекте - класс объекта, иерархию элементов объекта, первые значения каждого элемента и так далее. Для этих целей используется функция `str()` (от `structure`), которая выводит каждый элемент объекта в виде вектора значений. Например, при просмотре структуры таблицы `iris` мы получаем класс объекта (`data.frame`), количество строк и столбцов, название колонок, тип элементов и первые десять значений каждой колонки:
```{r 03-objects-info-17 }
str(iris)
```

При просмотре структуры списка, который в качестве одного из элементов содержит другой список, точно также отображается каждый элемент списка, его тип, в том числе и типы и элементы вложенного списка. Вложенный список дополнительно выделен точками и отступом:
```{r 03-objects-info-18 }
x <- list(e1 = 1:5,
          e2 = letters[1:5],
          e3 = list(e31 = rnorm(5), 
                    e32 = runif(5)))
str(x)
```



